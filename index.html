<!DOCTYPE html>
<html>
	<head>
		<title>Random Test Generator</title>
		<meta charset="utf-8" /> 
		<link rel="stylesheet" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" href="css/fontawesome-all.css">
		<link rel="stylesheet" href="css/index.css">
		<script src="js/jquery-3.5.1.min.js"></script>
		<script src="js/bootstrap.js"></script>
		<script src="js/papaparse.min.js"></script>
		<script src="js/handlebars.js"></script>
		<script defer src="js/index.js"></script>


		<script id="test-template" type="text/x-handlebars-template">
			{{!-- if-statement keeps empty options from rendering --}}

			<div class="row">
				<div class="col-lg-12 question">{{question}}</div>
			</div>
			<div class="radioContainer">
				<div class="button-wrap">
					{{#if opt1}}
						<input class="hidden radio-label" type="radio" name="radio-answer" id="opt1" value="1">
						<label class="button-label" for="opt1">{{opt1}}</label>
					{{/if}}
					{{#if opt2}}
						<input class="hidden radio-label" type="radio" name="radio-answer" id="opt2" value="2">
						<label class="button-label" for="opt2">{{opt2}}</label>
					{{/if}}
					{{#if opt3}}
						<input class="hidden radio-label" type="radio" name="radio-answer" id="opt3" value="3">
						<label class="button-label" for="opt3">{{opt3}}</label>
					{{/if}}
					{{#if opt4}}
						<input class="hidden radio-label" type="radio" name="radio-answer" id="opt4" value="4">
						<label class="button-label" for="opt4">{{opt4}}</label>
					{{/if}}
					{{#if opt5}}
						<input class="hidden radio-label" type="radio" name="radio-answer" id="opt5" value="5">
						<label class="button-label" for="opt5">{{opt5}}</label>
					{{/if}}
					{{#if opt1}}
						<input class="hidden radio-label" type="radio" name="radio-answer" id="opt6" value="6">
						<label class="button-label" for="opt6">{{opt6}}</label>
					{{/if}}					
				</div>
			</div>
		</script>

		<script>

			$.PAYLOAD = new Object();
			var dataTracker = new Object();
			var questionList = [];
			var currentQ = -1;	// idx of current, prev, next, last questions
			var nextQ = -1;
			var prevQ = -1;
			var lastQ = -1;
			var minPassing = -1;

			$(document).ready(function(){
			  $("#file").change(handleFileSelect);	

			  // event handlers
				var dropzone = $("#dz");
				dropzone.on("dragover", handleDragOver);
				dropzone.on("drop", handleFileDrop);
				dropzone.on("dragleave", handleDragLeave);
				$("#formOptions").on("submit", handleOptionsSubmit);	// MQF options screen
				$("#nextPage > a").on("click", paginateNext);		// next page btn
				$("#prevPage > a").on("click", paginatePrev);		// prev page btn
				$("#btnFinish").on("click", handleFinishTest);	// finish test
				$(".btn-mqf").on("click", handleStdMqf);	// pre-built MQF buttons
				$("#btnRetake").on("click", handleRetake);	// re-take same test
				$("#btnGenNew").on("click", true, handleRetake);


				/*  Range Input Slider */
				var slider = document.getElementById("inputPassingScore");
				var output = document.getElementById("rangeVal");
				output.innerHTML = slider.value;

				slider.oninput = function() {
				  output.innerHTML = this.value;
				}



			 });
		</script>

		<style>
			.btn-mqf {
				font-weight: bold;
			}
		</style>


	</head>

	<body class="container">

		<header id="jumbotron" class="jumbotron">
			<div class="container">
				<h1 class="display-4">Random Test Generator</h1>
				<p class="lead">Select from below or upload your own</p>
			</div>			
		</header>

		<section id="preBuiltMqf" class="row justify-content-center mb-5">
			<div>
				<h1 class="display-5 text-center">Pre-built MQFs</h1>
				<div class="btn-group">
					<button class="btn btn-primary btn-mqf" value="c-130">C-130</button>
					<button class="btn btn-secondary btn-mqf" value="c-17">C-17</button>
					<button class="btn btn-success btn-mqf" value="c-5">C-5</button>
					<button class="btn btn-danger btn-mqf" value="kc-10">KC-10</button>
					<button class="btn btn-warning btn-mqf" value="kc-135">KC-135</button>
					<button class="btn btn-info btn-mqf" value="vip-sam">VIP/SAM</button>
				</div>				
			</div>
		</section>
					
		<section id="uploadArea" class="container bg-secondary">
			<div class=col-lg-12>
				<h1 class="display-5 text-center text-white py-3">Custom Upload</h1>
		    <div id="dz" onclick="dropzoneClick()" accept=".csv,.txt" class="card card-body bg-light">		    
	    		<h1 class="text-center font-weight-bold">
	    			<i class="fas fa-cloud-upload-alt"></i>
	    			<span id="dzText">Drop your file here (or click)</span>
	    		</h1>	    	
		    </div>
		    <input type="file" name="file" id="file" class="d-none"/>
			</div> <!-- end dzCol -->



			<div class="justify-content-center row justify-content-center mt-5 pb-5">
				<div class="bg-light col-lg-10 row justify-content-center">	
					<div>
						<div class="py-3 text-center">
							<h2 class="display-5">Custom Upload Instructions</h2>
							<div id="instrToggle" data-toggle="collapse" data-target="#instrCollapse" class="row justify-content-center text-center">									
									<i class="fa fa-arrow-down fa-2x col-12"></i>
							</div>
						</div>
						<div id="instrCollapse" class="collapse">
							<ul>
								<li>Questions must be input into specially-formatted file</li>
								<li>The file name must end in ".csv" or ".txt" hint: (use Excel's 'tab delimited' option)
								<li>The file must be <em>tab-delimited</em> and use specific header names (without quotes):</li>
								<ul>
									<li>"question" - The actual question</li>
									<li>"opt1" - multiple-choice option 1-6 (blank is okay)</li>
									<li>"opt2"</li>
									<li>"opt3"</li>
									<li>"opt4"</li>
									<li>"opt5"</li>
									<li>"opt6"</li>
									<li>"ans" - number of the correct answer</li>
								</ul>
								<li>Download the <a href="template/template.csv">template</a></li>
								<ul>
									<li><b>To Edit:</b> You must import this file into Excel</li>
									<ol>
										<li>Open Blank workbook</li>
										<li>Select cell A1</li>
										<li>Select "Data" Tab</li>
										<li>In "Get External Data" section, select "from text"</li>
										<li>Locate & Open template file</li>
										<li>Excel will auto-detect settings so just hit "Finish" & then "OK"</li>
									</ol>
									<li><b>To Save:</b></li>
									<ol>
										<li>From Excel: File --> Save As</li>
										<li>Select Desktop or wherever you'd like to save</li>
										<li>Name the file</li>
										<li>From Drop-down, select: "Text (Tab delimited) (*.txt)</li>
										<li>Save</li>
										<li>Drag file into Drop-zone (on this page, above)</li>
									</ol>
								</ul>
							</ul>
						</div>
					</div>
				</div>
			</div>

		</section> <!-- end uploadArea -->

		<section id="optArea" class="container d-none mt-5">
			<div class="card">
				<h1 class="card-header">Select Options</h1>
				<form id="formOptions" class="card-body">
					<div class="form-group row justify-content-center">
						<label for="inputQuestions" class="col-sm-4 col-form-label"># of Questions</label>
						<div class="col-sm-2">
							<select id="inputQuestions" class="form-control">
								<option selected>Choose...</option>
							</select>
						</div>
					</div>
					<div class="form-group row justify-content-center">
						<label for="inputPassingScore" class="col-sm-4 col-form-label">Min Passing Score</label>
						<input type="range" min="50" max="100" value="75" class="form-control-range col-sm-2" id="inputPassingScore">
						<span id="rangeVal">75</span>
					</div>
					<div class="form-group row justify-content-center">
						<div class="col-sm-12 text-center">
							<button type="submit" id="btnSubmitOpts" class="btn btn-primary">Submit</button>
						</div>
					</div>
				</form>
			</div>
		</section> <!--end optArea -->

		<!-- Test Display Area -->
		<div id="testArea" class="row justify-content-center d-none">
			<div class="card col-lg-6 p-0 mt-5">
				<h1 class="card-header text-center">						
					Please answer the following questions
				</h1>					
		
				<div id="testContent" class="card-body">

					<div id="testContentQuestion">
						<!-- Question Template fills here -->						
					</div>

					<nav>
						<ul class="pagination">
							<li id="prevPage" class="page-item disabled">
								<a class="page-link" href="#" tabindex="-1">Prev</a>
							</li>
							<li id="currPage" class="page-item"><span class="page-link">1</span></li>
					    <li id="nextPage" class="page-item">
					      <a class="page-link" href="#">Next</a>
					    </li>
						</ul>
					</nav>
					<div>
						<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalSubmit">Finish Test</button>
					</div>
				</div> <!-- END card-body -->
			</div> <!-- end card -->
		</div> <!-- end testArea -->

		<!-- Results -->
		<div id="resultsArea" class="d-none row justify-content-center">			
			<section class="col-lg-6">
				<h3 id="resultBanner" class="card-header">--Result Placeholder--</h3>
				<div class="card-body">
					<h3>Your score:</h3>
					<h4 id="resultScore">--score placeholder--</h4>
				</div>
				<button id="btnRetake" type="button" class="btn btn-secondary">Retake</button>
				<button id="btnGenNew" type="button" class="btn btn-primary">Retake & Randomize</button>
			</section>

			
		</div> <!-- END resultsArea -->

		<!-- Confirmation Modal -->
		<div id="modalSubmit" class="modal fade" role="dialog" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel">Confirm</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
					<div class="modal-body">
						<h3>Do you wish to submit your test?</h3>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" id="btnFinish">Yes, Submit</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					</div>
				</div>	
			</div>
		</div> <!-- END confirmation modal -->

	</body>


</html>