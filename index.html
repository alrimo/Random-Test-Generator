<!DOCTYPE html>
<html>
	<head>
		<title>Random Test Generator</title>
		<meta charset="utf-8" /> 
		<link rel="stylesheet" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" href="css/fontawesome-all.css">
		<script src="js/jquery-3.5.1.min.js"></script>
		<script src="js/bootstrap.js"></script>
		<script src="js/papaparse.min.js"></script>

		<script>


			$.PAYLOAD = new Object();

			$(document).ready(function(){
			    $("#file").change(handleFileSelect);	

			    var dropzone = document.getElementById("dz");
					dropzone.addEventListener('dragover', handleDragOver, false);
					dropzone.addEventListener('drop', handleFileDrop, false);
					dropzone.addEventListener('dragleave', handleDragLeave, false);
			 });

		</script>

		<style>
			/* Styles here */

		</style>

	</head>

	<body>
		
			

			<div class="container">
				<div class=col-lg-12>
			    <div id="dz" onclick="dropzoneClick()" accept=".csv" class="card card-body bg-light">
			    	<center>
			    		<h1>
			    			<i class="fas fa-cloud-upload-alt"></i>
			    			<span id="dzText">Drop your file here (or click)</span>
			    		</h1>
			    	</center>
			    </div>
			    <input type="file" name="file" id="file" class="d-none"/>
				</div>
			</div>



		

	</body>

	<script>

		function handleFileDrop(evt) {
		  evt.stopPropagation();
		  evt.preventDefault();

		  var files = evt.dataTransfer.files; 
		  console.log('Caught a File!');
		  doUpload(files[0]);
		  console.log($.PAYLOAD);
		}

		function handleDragOver(evt) {
		  evt.stopPropagation();
		  evt.preventDefault();
		  evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
	 
		  $("#dz").addClass("bg-dark text-white");
		  $("#dzText").text("Release to upload");

		}

		function handleDragLeave(evt) {
			evt.stopPropagation();
			evt.preventDefault();

			$("#dz").removeClass("bg-dark text-white");
			$("#dzText").text("Drop your file here (or click)");

		}



		function doUpload(e) { 
		  console.log('attempt');
		  Papa.parse(e, {
		    header:true,
		    before: function(file, inputElem){ console.log('Attempting to Parse...')},
		    error: function(err, file, inputElem, reason){ console.log(err); },
		    complete: function(results, file){ $.PAYLOAD = results; }
		  });
		}

		function dropzoneClick(evt){
		  $('#file').click();
		}

		 
		 
		function handleFileSelect(evt) {
		  var file = evt.target.files[0];

		  Papa.parse(file, {
		    header: true,
		    dynamicTyping: true,
		    complete: function(results) {
		      console.log(results);
		    }
		  });
		}
 
  

	</script>



</html>